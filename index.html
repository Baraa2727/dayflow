<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>TripFlow – Smarte Tagesrouten</title>
    <meta name="theme-color" content="#000000" />

    <!-- PWA: manifest + icons (leave as-is in your project) -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/logo.png" />

    <style>
      :root {
        --bg: #ffffff;
        --fg: #111418;
        --muted: #6b7280; /* gray-500 */
        --brand: #111111;
        --ring: rgba(0,0,0,0.08);
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--fg);
        background: var(--bg);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
      }

      /* Hide any Vercel debug/insights floating buttons if injected */
      #vercel-toolbar,
      [data-vercel-insights-overlay],
      .vercel-insights,
      .__vercel,
      [data-cka-fab],
      .nextjs-portal {
        display: none !important;
      }

      a { color: inherit; text-decoration: none; }
      button { cursor: pointer; background: transparent; border: 0; }
      button, input, textarea { outline: none; }

      .container { max-width: 930px; margin: 0 auto; padding: 16px 16px 96px; }

      /* Header */
      .topbar { display: flex; align-items: center; justify-content: space-between; padding: 12px 8px; }
      .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; }
      .brand img { width: 28px; height: 28px; border-radius: 50%; background:#000; }
      .user { width: 32px; height: 32px; border-radius: 50%; display: grid; place-items: center; border: 1px solid #e5e7eb; }

      .h1 { font-size: clamp(28px, 6vw, 40px); line-height: 1.1; margin: 14px 0 4px; font-weight: 800; }
      .h2 { color: var(--muted); margin: 0 0 18px; }

      /* Chat input */
      .inputWrap {
        position: relative;
        border-radius: 18px;
        padding: 12px 56px 12px 56px;
        box-shadow: 0 0 0 1px #e5e7eb inset, 0 2px 12px var(--ring);
      }
      .inputWrap:focus-within { box-shadow: 0 0 0 2px #111 inset, 0 6px 20px var(--ring); }

      .prompt {
        width: 100%;
        min-height: 56px;
        border: 0;
        resize: none;
        font-size: 16px; /* prevents iOS zoom */
        line-height: 1.45;
        color: var(--fg);
        background: transparent;
      }

      /* Mic & Send buttons – no ugly outlines or borders */
      .btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 40px; height: 40px;
        display: grid; place-items: center;
        border-radius: 12px;
        box-shadow: 0 0 0 1px #e5e7eb inset;
        transition: transform .08s ease, box-shadow .15s ease, background .15s ease;
        background: #fff;
      }
      .btn:active { transform: translateY(-50%) scale(0.98); }
      .btn:hover { box-shadow: 0 0 0 1px #d1d5db inset; }

      .btn-mic { left: 8px; }
      .btn-send { right: 8px; }

      .btn svg { width: 18px; height: 18px; }
      .recording { background: #000; color: #fff; box-shadow: 0 0 0 1px #000 inset; }

      /* Example prompts – clean, no frames */
      .examples { display: flex; gap: 8px; align-items: center; margin: 10px 4px 0; color: var(--muted); font-size: 13px; }
      .example-roller { position: relative; height: 18px; overflow: hidden; }
      .example-roller > div { position: absolute; left: 0; top: 0; white-space: nowrap; transition: transform .5s ease; }

      .help { margin: 14px 4px 0; color: var(--muted); font-size: 12px; }

      /* Output card */
      .card {
        margin-top: 16px;
        padding: 16px;
        border-radius: 14px;
        box-shadow: 0 0 0 1px #e5e7eb inset;
        background: #fff;
      }
      .card h3 { margin: 0 0 8px; }

      footer { text-align: center; font-size: 12px; color: var(--muted); padding: 28px 0; }

      /* Splash screen overlay (keeps main page white) */
      .splash {
        position: fixed; inset: 0; z-index: 9999;
        background: #000; display: grid; place-items: center;
        animation: splash-hold 1600ms cubic-bezier(.2,.8,.2,1) both, fade-out 400ms ease 1600ms forwards;
      }
      .splash-inner { display: grid; place-items: center; gap: 14px; }
      .logo {
        width: 74px; height: 74px; border-radius: 50%;
        background: #111; display: grid; place-items: center; box-shadow: 0 0 0 1px rgba(255,255,255,.15) inset, 0 0 40px rgba(255,255,255,.08);
        animation: pulse 1200ms ease-in-out infinite;
      }
      .logo img { width: 36px; height: 36px; filter: invert(1); }
      .splash-title { color: #fff; font-weight: 700; letter-spacing: .3px; }

      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: .9; }
        50% { transform: scale(1.04); opacity: 1; }
      }
      @keyframes fade-out { to { opacity: 0; visibility: hidden; } }
      @keyframes splash-hold { from { opacity: 1; } to { opacity: 1; } }

      /* Utilities */
      .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
    </style>
  </head>
  <body>
    <!-- Splash overlay (kept a bit longer, fade on exit) -->
    <div id="splash" class="splash" aria-hidden="true">
      <div class="splash-inner">
        <div class="logo"><img src="/logo.png" alt="TripFlow" /></div>
        <div class="splash-title">TripFlow</div>
      </div>
    </div>

    <div class="container">
      <header class="topbar">
        <div class="brand">
          <img src="/logo.png" alt="TripFlow" />
          <div>TripFlow</div>
        </div>
        <div class="user" aria-label="Profil">
          <!-- user icon -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21a8 8 0 1 0-16 0"/><circle cx="12" cy="7" r="4"/></svg>
        </div>
      </header>

      <h1 class="h1">Smarte Tagesrouten</h1>
      <p class="h2">Klar, klickbar, ready.</p>

      <section class="inputWrap">
        <textarea id="prompt" class="prompt" placeholder="Erstelle eine Tagestour in Berlin bei Regen." rows="2"></textarea>
        <button id="micBtn" class="btn btn-mic" aria-label="Spracheingabe starten">
          <svg id="micIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3z"/><path d="M19 11a7 7 0 0 1-14 0"/><path d="M12 19v3"/></svg>
        </button>
        <button id="sendBtn" class="btn btn-send" aria-label="Absenden">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22 2 11 13"/><path d="M22 2 15 22 11 13 2 9z"/></svg>
        </button>
      </section>

      <div class="examples" id="examples">
        <span>Beispiele:</span>
        <div class="example-roller" aria-hidden="true">
          <div id="exampleLine"></div>
        </div>
      </div>

      <p class="help">Sprache: Mikro antippen – auf unterstützten Browsern wird deine Sprachnachricht als Text erkannt.</p>

      <div class="card">
        <h3>Ausgabe</h3>
        <p>Frag mich z. B. nach einer Tagestour – ich liefere dir eine klare Route mit klickbaren Stopps.</p>
      </div>

      <footer>© <span id="year"></span> TripFlow</footer>
    </div>

    <script>
      // Year
      document.getElementById('year').textContent = new Date().getFullYear();

      // Splash dismissal (kept longer via CSS; also ensure we remove node after anim end)
      const splash = document.getElementById('splash');
      splash.addEventListener('animationend', (e) => {
        if (e.animationName === 'fade-out') splash.remove();
      });

      // Rotating example prompts (no frames)
      const EXAMPLES = [
        'Ich bin in Lissabon – plane einen halben Tag mit Aussichtspunkten.',
        'Streetfood in Bangkok + Rooftop-Bar am Ende.',
        'Familientag in München bei Regen – Indoor & Café.',
        'Rom: antike Highlights + Gelato-Stopps.',
        'Tokio: trendige Viertel & ein kurzer Spaziergang.'
      ];
      const line = document.getElementById('exampleLine');
      let idx = 0;
      function renderExample() {
        line.style.transform = 'translateY(100%)';
        setTimeout(() => {
          line.textContent = EXAMPLES[idx % EXAMPLES.length];
          idx++;
          line.style.transform = 'translateY(0)';
        }, 250);
      }
      renderExample();
      const rot = setInterval(renderExample, 3500);

      // Hide examples when user focuses/starts typing
      const promptEl = document.getElementById('prompt');
      const examples = document.getElementById('examples');
      function hideExamples(){ examples.style.display = 'none'; clearInterval(rot); }
      promptEl.addEventListener('focus', hideExamples, { once: true });
      promptEl.addEventListener('input', hideExamples, { once: true });

      // Microphone (Web Speech API) with Safari/iOS support
      const micBtn = document.getElementById('micBtn');
      const micIcon = document.getElementById('micIcon');
      let recognition, listening = false;
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

      if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'de-DE';
        recognition.interimResults = true;
        recognition.maxAlternatives = 1;

        recognition.addEventListener('result', (event) => {
          let transcript = '';
          for (let i = event.resultIndex; i < event.results.length; i++) {
            transcript += event.results[i][0].transcript;
          }
          promptEl.value = transcript.trim();
        });
        recognition.addEventListener('end', () => {
          listening = false;
          micBtn.classList.remove('recording');
        });

        micBtn.addEventListener('click', () => {
          if (!listening) {
            try {
              recognition.start();
              listening = true;
              micBtn.classList.add('recording');
            } catch (e) { /* ignored: start called quickly */ }
          } else {
            recognition.stop();
          }
        });
      } else {
        // Fallback: brief vibration + toast
        micBtn.addEventListener('click', () => {
          if (navigator.vibrate) navigator.vibrate(30);
          alert('Spracheingabe wird von diesem Browser leider nicht unterstützt.');
        });
      }

      // Submit handler (wire to your /api/generate if needed)
      const sendBtn = document.getElementById('sendBtn');
      sendBtn.addEventListener('click', () => {
        // TODO: Hook into /api/generate
        if (!promptEl.value.trim()) {
          promptEl.focus();
          return;
        }
        console.log('Send prompt:', promptEl.value.trim());
      });

      // Prevent any default focus rings on buttons on iOS after tap
      document.addEventListener('touchstart', function(){}, {passive: true});
    </script>

    <!-- Register Service Worker if present -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(() => {});
        });
      }
    </script>
  </body>
</html>
